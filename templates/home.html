<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="refresh" content="60">
        <title>Revocation Tracker</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    </head>
    <body>
        <div class="container">
            <div class="header container">
                <h3 class="text-muted">Revocation Tracker</h3>
            </div>

            <div class="jumbotron">
                <p class="lead">
                    This site is for tracking whether CAs have revoked
                    certificates in a timely manner, as required by the
                    Baseline Requirements.
                </p>
                <div class="panel panel-default">
                    <div class="panel-body">
                        <form class="form-inline" action="/add-certificate/" method="post">
                            <div class="form-group">
                                <label for="crtsh-id">Add a certificate:</label>
                                <input type="text" name="crtsh-id" class="form-control" placeholder="crt.sh id">
                            </div>
                            <button type="submit" class="btn btn-default">Submit</button>
                        </form>
                    </div>
                </div>
            </div>

            {% for label, certs in [("Still Valid", valid_certs), ("Expired", expired_certs), ("Revoked", revoked_certs)] %}
                <h3>{{ label }} ({{ certs|length }})</h3>
                {% if certs %}
                    <table class="table table-striped">
                        <thead>
                            <th>crt.sh id</th>
                            <th>Subject Common Name</th>
                            <th>SAN dNSNames</th>
                            <th>Started tracking</th>
                            <th>Expires on</th>
                        </thead>
                        <tbody>
                            {% for group in certs|sort(attribute="certificate.issuer_common_name")|groupby("certificate.issuer_common_name") %}
                                <tr>
                                    <td colspan="6"><strong>{{ group.grouper }}</strong></td>
                                </tr>
                                {% for cert in group.list|sort(attribute="certificate.expiration_date") %}
                                    <tr>
                                        <td>
                                            <a href="https://crt.sh/?id={{ cert.certificate.crtsh_id }}&opt=cablint">
                                                <code>{{ cert.certificate.crtsh_id }}</code>
                                            </a>
                                        </td>
                                        <td><code>{{ cert.certificate.common_name }}</code></td>
                                        <td>
                                            {% for n in cert.certificate.san_dns_names %}
                                                <code>{{ n }}</code>{% if not loop.last %},{% endif %}
                                            {% endfor %}
                                        </td>
                                        <td><time class="timeago" datetime="{{ cert.added_at }}Z"></time></td>
                                        <td>{{ cert.certificate.expiration_date.date() }}</td>
                                    </tr>
                                {% endfor %}
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No certs in this category</p>
                {% endif %}
            {% endfor %}
        </div>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.6.1/jquery.timeago.min.js" integrity="sha256-JAdlnMiYFZRwqQqgiYwLjSkV94QtVzcbvasQMm05THk=" crossorigin="anonymous"></script>
        <script type="text/javascript">
            $(function() {
                $("time.timeago").timeago();
            })
        </script>
    </body>
</html>
